{% load static i18n %}

{% block extrahead %}
  <style>
    #content div.meta-widget {
        padding: 5px 15px;
    }
    #content .meta-widget p {
        margin: 0;
    }
    .columns-selector-wrapper {
    }
    .columns-selector-wrapper input[type=text] {
        min-width: 200px;
        margin-right: 20px;
    }
    #render-meta_columns tbody tr:nth-child(1) {
        border-top: 2px solid #cccccc;
    }
    #render-meta_columns tbody tr:nth-child(2) {
        border-bottom: 2px solid #cccccc;
    }
    .redactor-disabled{
      cursor: not-allowed;
    }
    .meta-widget .add-record {
      text-align: center;
      font-size: 0.8em;
      text-decoration: underline;
      padding: 0;
      cursor: pointer;
      color: #304154;
    }
    #csv-models-config table.meta-models-columns {
      padding-bottom: 0;
    }
  </style>
{% endblock %}

<div class="meta-widget {{ widget.name }}">
  {% comment %}
  we need the json.dumps version here, by default, in case the
  user saves this before editing. the JS of this widget will
  overwrite this with proper JSON as users modify it
  {% endcomment %}
  <textarea style="display:none;"
            id="json-{{ widget.name }}"
            name="{{ widget.name }}"
     {% include "django/forms/widgets/attrs.html" %}>
    {% if widget.value %}{{ widget.value }}{% endif %}
  </textarea>

  <table id="render-{{ widget.name }}"
         class="columns-selector-wrapper sortable meta-models-columns">
    <thead>
      <tr>
        <th>&nbsp;</th>
        <th>
          Column name
        </th>
        <th>
          Data type
        </th>
        <th>
          Field Options
        </th>
        <th>
          Searchable
        </th>
        <th>
          Filterable
        </th>
        <th>
          Delete
        </th>
      </tr>
    </thead>
    <tbody class="{{ widget.name }}">
      <tr class="column-selector"
          rv-on-change="onchange"
          rv-each-column="columns">
        <td class="grabber-column">
          <span class="grippy"></span>
        </td>
        <td class="option">
          <input type="text"
                 name="name"
                 rv-value="column.name" />
        </td>
        <td class="option">
          <select name="type" rv-value="column.type">
            {% for column_value, column_name in widget.column_types %}
            <option value="{{ column_value }}">
            {{ column_name }}
            </option>
            {% endfor %}
          </select>
        </td>
        <td class="fourth-column option">
          <input type="text"
                 name="options"
                 placeholder="Max length (default: 500 chars)"
                 rv-if="istype|call column.type 'short-text'"
                 rv-value="column.options" />
          </input>
          <input type="text"
                 name="options"
                 placeholder="Choices (e.g.: option-1, option-2)"
                 rv-if="istype|call column.type 'choice'"
                 rv-value="column.options" />
          </input>
        </td>
        <td class="option center">
          <input type="checkbox"
                 name="searchable"
                 class="clickable"
                 rv-checked="column.searchable" />
        </td>
        <td class="option center">
          <input type="checkbox"
                 name="filterable"
                 class="clickable"
                 rv-checked="column.filterable" />
          <!-- hidden fields, positional index -->
          <input type="hidden"
                 name="ix"
                 rv-value="column.ix" />
        </td>
        <td class="option center">
          <img rv-on-click="destroy"
               class="clickable trashcan"
               src="{% static 'django_models_from_csv/trash.svg' %}"
               alt="Delete" />
        </td>
      </tr>
    </tbody>
  </table>
  <div class="add-record">
    <span rv-on-click="addField">
      + Add Field
    </span>
  </div>
</div>
