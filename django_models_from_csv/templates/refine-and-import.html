{% extends "django_models_from_csv/base.html" %}
{% load i18n static %}

{% block title %}
Database Columns | {{ block.super }}
{% endblock %}

{% block content %}
<div id="csv-models-config">
  <h2>Refine Database</h2>
  <form action="{% url 'csv_models:refine-and-import' dynmodel.id %}" method="POST">
      {% if errors %}
      <h3>Import Errors</h3>
      {% for err in errors %}
          <p>
              <b>{{err}}</b><br/>
          </p>
      {% endfor %}
      {% endif %}

      {% if error_message %}
      <h3>Import Error</h3>
      <p>
          {{error_message}}
      </p>
      {% endif %}
      <p>
      {% blocktrans trimmed %}
          These are the columns we found in your sheet. Feel free
          to change the data types or set fields you want to search,
          filter or redact.
      {% endblocktrans %}
      </p>
      <p>
      {% blocktrans trimmed %}
          The first five fields (below) will be displayed in the
          imported records list. The remaining columns will
          only be shown inside each record's full detail page.
          Re-order the columns by dragging them around.
      {% endblocktrans %}
      </p>
      <p>
      {% blocktrans trimmed %}
      In order to use redaction on your columns, you need to
      {% endblocktrans %}
      <a rel="noopener noreferrer" target="_blank" href="{% url 'setup-credentials' %}">{% trans 'set up Google Cloud Data Loss Prevention credentials here.' %}</a>
      {% blocktrans trimmed %}
      When you are done, refresh the page.
      {% endblocktrans %}
      </p>
      {{ form.columns }}
      <div id="meta-models">
        <h4>{% trans 'Metadata' %}</h4>
        <p>
        {% blocktrans trimmed %}
            Metadata fields allow you to annotate, tag and enhance your
            imported data. The first two fields will be displayed in
            imported records list, before all other fields.
        {% endblocktrans %}
        </p>

        {% if n_records %}
        <ul class="messagelist">
          <li class="warning">
            {% blocktrans trimmed %}
            You have data imported. If you delete a field, the data for
            that field will be lost.
            {% endblocktrans %}
          </li>
        </ul>
        {% endif %}

        {{ form.meta_columns }}
        <h4>{% trans 'Contact Log/History' %}</h4>
        <p>
        {% blocktrans trimmed %}
            The contact log lets you maintain an ordered record of information
            related to your imported rows. This can be used for keeping
            track of contact with sources or investigation progress. These
            fields will not be shown in the imported records list, but will
            be available on the individual record page.
        {% endblocktrans %}
        </p>
        {{ form.contactmeta_columns }}
      </div>
      <div class="continue">
          <input type="hidden"
                 id="n_records"
                 name="n_records"
                 value="{{ n_records }}" />
          <input type="submit" value="{% trans "Continue" %}" />
      </div>
      {% csrf_token %}
  </form>
</div>
{% endblock %}
